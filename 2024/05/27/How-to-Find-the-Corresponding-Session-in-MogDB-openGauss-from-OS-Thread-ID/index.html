<!DOCTYPE html>
<html lang="en">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Kamus">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Kamus">
    
        <meta name="keywords" content="database,database-tuning,postgresql,opengauss,mogdb">
    
    <meta name="description" content="">
    <meta name="description" content="Diagnostic NeedsWhen the MogDB database consumes a significant amount of system resources, such as nearly 100% CPU usage, how can we determine which session(s) in the database are using these resource">
<meta property="og:type" content="article">
<meta property="og:title" content="How to Find the Corresponding Session in MogDB&#x2F;openGauss from OS Thread ID">
<meta property="og:url" content="http://kamusis.github.io/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/index.html">
<meta property="og:site_name" content="Kamus&#39; Notes">
<meta property="og:description" content="Diagnostic NeedsWhen the MogDB database consumes a significant amount of system resources, such as nearly 100% CPU usage, how can we determine which session(s) in the database are using these resource">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/05/30/HmitAhrOMNaX9WB.png">
<meta property="article:published_time" content="2024-05-27T06:55:48.000Z">
<meta property="article:modified_time" content="2024-05-27T07:01:07.248Z">
<meta property="article:author" content="Kamus">
<meta property="article:tag" content="MogDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/05/30/HmitAhrOMNaX9WB.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    
    <title>How to Find the Corresponding Session in MogDB/openGauss from OS Thread ID · Kamus&#39; Notes</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20240527" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20240527" as="style">
    <link rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" href="/css/mobile.css?v=20240527" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20240527" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20240527" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- Google tag (gtag.js) -->
    

<meta name="generator" content="Hexo 7.2.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>Kamus' Notes.</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">Kamus&#39; Notes.</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">How to Find the Corresponding Session in MogDB/openGauss from OS Thread ID</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
    
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                How to Find the Corresponding Session in MogDB/openGauss from OS Thread ID
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="MogDB">MogDB</a>
    
</div>

                
                <!-- 文章字数统计 -->
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2024/05/27</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h3 id="Diagnostic-Needs"><a href="#Diagnostic-Needs" class="headerlink" title="Diagnostic Needs"></a>Diagnostic Needs</h3><p>When the MogDB database consumes a significant amount of system resources, such as nearly 100% CPU usage, how can we determine which session(s) in the database are using these resources?</p>
<p>In Oracle databases, diagnosing such issues typically involves associating <code>v$session</code>, <code>v$process</code>, and the OS process ID found using the <code>top</code> or <code>ps</code> commands. However, MogDB uses a thread model, and only one process ID is visible at the OS level. So, how do we pinpoint the problem?</p>
<p>Since MogDB uses a thread model, unlike PostgreSQL’s process model, checking network port access with the <code>lsof</code> command at the OS level will show multiple user sessions connected, but only the process ID will be displayed in the PID column, not the thread.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lsof -i 4 -a -p `pgrep -u omm3 mogdb`</span></span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">mogdb   12027   omm3    8u  IPv4 20313752      0t0  TCP *:biimenu (LISTEN)</span><br><span class="line">mogdb   12027   omm3    9u  IPv4 20313753      0t0  TCP *:18001 (LISTEN)</span><br><span class="line">mogdb   12027   omm3  325u  IPv4 28320946      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45206 (ESTABLISHED)</span><br><span class="line">mogdb   12027   omm3  330u  IPv4 28316174      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45208 (ESTABLISHED)</span><br><span class="line">mogdb   12027   omm3  336u  IPv4 28302815      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45210 (ESTABLISHED)</span><br><span class="line">mogdb   12027   omm3  340u  IPv4 28323140      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45212 (ESTABLISHED)</span><br><span class="line">mogdb   12027   omm3  360u  IPv4 28323141      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45214 (ESTABLISHED)</span><br><span class="line">mogdb   12027   omm3  375u  IPv4 28305050      0t0  TCP mogdb-kernel-0004:biimenu-&gt;softbank060132034173.bbtec.net:45216 (ESTABLISHED)</span><br></pre></td></tr></table></figure>

<h3 id="How-to-Get-Thread-ID"><a href="#How-to-Get-Thread-ID" class="headerlink" title="How to Get Thread ID"></a>How to Get Thread ID</h3><p>You can use <code>htop</code>. After opening <code>htop</code>, press F5 to display the process tree. The first PID is the process ID, and each line under the tree structure shows the corresponding thread ID for that process.</p>
<p><img src="https://s2.loli.net/2022/05/30/HmitAhrOMNaX9WB.png" alt="img"></p>
<p>You can also use the <code>ps</code> command. The <code>-L</code> parameter displays threads, and the <code>-o</code> parameter specifies the columns of interest.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ps -Lp `pgrep -u omm3 mogdb` -o %cpu,tid,pid,ppid,cmd,<span class="built_in">comm</span></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">CPU   TID   PID  PPID CMD                         COMMAND</span></span><br><span class="line"> 0.0 17847 17847     1 /opt/mogdb3/app/bin/mogdb - mogdb</span><br><span class="line"> 0.0 17848 17847     1 /opt/mogdb3/app/bin/mogdb - jemalloc_bg_thd</span><br><span class="line"> 0.0 17854 17847     1 /opt/mogdb3/app/bin/mogdb - mogdb</span><br><span class="line"> 0.0 17855 17847     1 /opt/mogdb3/app/bin/mogdb - syslogger</span><br><span class="line"> 0.0 17856 17847     1 /opt/mogdb3/app/bin/mogdb - reaper</span><br><span class="line"> 0.0 17857 17847     1 /opt/mogdb3/app/bin/mogdb - jemalloc_bg_thd</span><br><span class="line"> 0.0 17858 17847     1 /opt/mogdb3/app/bin/mogdb - jemalloc_bg_thd</span><br><span class="line"> 0.0 17860 17847     1 /opt/mogdb3/app/bin/mogdb - jemalloc_bg_thd</span><br><span class="line"> 0.0 17884 17847     1 /opt/mogdb3/app/bin/mogdb - checkpointer</span><br><span class="line"> 0.0 17885 17847     1 /opt/mogdb3/app/bin/mogdb - Spbgwriter</span><br><span class="line"> 0.1 17886 17847     1 /opt/mogdb3/app/bin/mogdb - pagewriter</span><br><span class="line"> 0.0 17887 17847     1 /opt/mogdb3/app/bin/mogdb - pagewriter</span><br><span class="line"> 0.0 17888 17847     1 /opt/mogdb3/app/bin/mogdb - pagewriter</span><br><span class="line"> 0.0 17889 17847     1 /opt/mogdb3/app/bin/mogdb - pagewriter</span><br><span class="line"> 0.0 17890 17847     1 /opt/mogdb3/app/bin/mogdb - pagewriter</span><br><span class="line"> 0.8 17891 17847     1 /opt/mogdb3/app/bin/mogdb - WALwriter</span><br><span class="line"> 0.0 17892 17847     1 /opt/mogdb3/app/bin/mogdb - WALwriteraux</span><br><span class="line"> 0.0 17893 17847     1 /opt/mogdb3/app/bin/mogdb - AVClauncher</span><br><span class="line"> 0.0 17894 17847     1 /opt/mogdb3/app/bin/mogdb - Jobscheduler</span><br><span class="line"> 0.0 17895 17847     1 /opt/mogdb3/app/bin/mogdb - asyncundolaunch</span><br><span class="line"> 0.0 17896 17847     1 /opt/mogdb3/app/bin/mogdb - globalstats</span><br><span class="line"> 0.0 17897 17847     1 /opt/mogdb3/app/bin/mogdb - applylauncher</span><br><span class="line"> 0.0 17898 17847     1 /opt/mogdb3/app/bin/mogdb - statscollector</span><br><span class="line"> 0.0 17899 17847     1 /opt/mogdb3/app/bin/mogdb - snapshotworker</span><br><span class="line"> 0.1 17900 17847     1 /opt/mogdb3/app/bin/mogdb - TrackStmtWorker</span><br><span class="line"> 0.0 17901 17847     1 /opt/mogdb3/app/bin/mogdb - 2pccleaner</span><br><span class="line"> 0.0 17902 17847     1 /opt/mogdb3/app/bin/mogdb - faultmonitor</span><br><span class="line"> 0.0 17904 17847     1 /opt/mogdb3/app/bin/mogdb - undorecycler</span><br><span class="line"> 0.0 18372 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18373 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18374 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18375 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18376 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18377 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18378 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18379 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18380 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18381 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18382 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 18454 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 19475 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 19480 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 29529 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br><span class="line"> 0.0 30999 17847     1 /opt/mogdb3/app/bin/mogdb - worker</span><br></pre></td></tr></table></figure>

<p>The rows in the <code>comm</code> column that display as “worker” are backend processes of user sessions in the database. Typically, user sessions that consume high CPU can be filtered to show only user sessions using the <code>grep</code> command.</p>
<h3 id="How-to-Map-OS-Thread-ID-to-Database-Session"><a href="#How-to-Map-OS-Thread-ID-to-Database-Session" class="headerlink" title="How to Map OS Thread ID to Database Session"></a>How to Map OS Thread ID to Database Session</h3><p>Suppose on this server, the thread with ID 18372 is consuming a lot of CPU. In MogDB, you can query the <code>pg_os_threads</code> view to find the session ID corresponding to this thread.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MogDB<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pg_os_threads <span class="keyword">where</span> lwpid<span class="operator">=</span><span class="number">18372</span>;</span><br><span class="line"></span><br><span class="line">node_name <span class="operator">|</span> pid              <span class="operator">|</span> lwpid <span class="operator">|</span> thread_name <span class="operator">|</span> creation_time</span><br><span class="line"><span class="comment">----------+------------------+-------+-------------+------------------------------</span></span><br><span class="line">dn_6001   <span class="operator">|</span> <span class="number">140545137571584</span>  <span class="operator">|</span> <span class="number">18372</span> <span class="operator">|</span> dn_6001     <span class="operator">|</span> <span class="number">2022</span><span class="number">-05</span><span class="number">-30</span> <span class="number">19</span>:<span class="number">54</span>:<span class="number">42.459129</span><span class="operator">+</span><span class="number">08</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>The <code>pg_os_threads</code> view records the relationship between lightweight thread IDs and session IDs. The <code>lwpid</code> column is the OS thread ID, and the <code>pid</code> column is the database session ID. For detailed information, refer to the MogDB documentation on <code>PG_OS_THREADS</code>.</p>
<p>If you have <code>monadmin</code> privileges, you can also query the <code>os_threads</code> view in the <code>dbe_perf</code> schema, which provides the same information.</p>
<p>After finding the database session ID, you can perform various actions, such as querying the <code>dbe_perf.session_stat_activity</code> view to get the application name, client IP address, and the SQL query being executed by that session.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MogDB<span class="operator">=</span># <span class="keyword">select</span> application_name, client_addr, query <span class="keyword">from</span> dbe_perf.session_stat_activity <span class="keyword">where</span> pid<span class="operator">=</span><span class="number">140545137571584</span>;</span><br><span class="line"></span><br><span class="line">application_name <span class="operator">|</span> client_addr <span class="operator">|</span> query</span><br><span class="line"><span class="comment">-----------------+-------------+---------------------------------------------</span></span><br><span class="line">dn_6001          <span class="operator">|</span> <span class="number">172.16</span><span class="number">.0</span><span class="number">.176</span><span class="operator">|</span> <span class="keyword">SELECT</span> cfg_value <span class="keyword">FROM</span> bmsql_config <span class="keyword">WHERE</span> cfg_name <span class="operator">=</span> $<span class="number">1</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>You can also query the <code>dbe_perf.thread_wait_status</code> view to get the current wait event of the session. Note that this view contains the <code>lwtid</code> field, which directly corresponds to the thread ID.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MogDB<span class="operator">=</span># <span class="keyword">select</span> lwtid, wait_status, wait_event <span class="keyword">from</span> dbe_perf.thread_wait_status <span class="keyword">where</span> sessionid<span class="operator">=</span><span class="number">140545137571584</span>;</span><br><span class="line"></span><br><span class="line">lwtid <span class="operator">|</span> wait_status <span class="operator">|</span> wait_event</span><br><span class="line"><span class="comment">------+-------------+-----------</span></span><br><span class="line"><span class="number">18372</span> <span class="operator">|</span> wait cmd    <span class="operator">|</span> wait cmd</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>




    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>Author：<a href="http://kamusis.github.io">Kamus</a>
            <p>Link：<a href="http://kamusis.github.io/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/">http://kamusis.github.io/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/</a>
            <p>Publish date：<a href="http://kamusis.github.io/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/">May 27th 2024, 3:55:48 pm</a>
            <p>Update date：<a href="http://kamusis.github.io/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/">May 27th 2024, 4:01:07 pm</a>
            <p>License：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2024/05/27/How-to-build-blog-site-by-using-Hexo-in-Windows-WSL-and-deploy-to-GitHub-Pages/" title="How to build blog site by using Hexo in Windows WSL and deploy to GitHub Pages">
                    <div class="nextTitle">How to build blog site by using Hexo in Windows WSL and deploy to GitHub Pages</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2024/05/27/MogDB-ASH-Unveiling-the-Active-Session-History-for-Powerful-Database-Performance-Tuning/" title="MogDB ASH: Unveiling the Active Session History for Powerful Database Performance Tuning">
                    <div class="prevTitle">MogDB ASH: Unveiling the Active Session History for Powerful Database Performance Tuning</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:kamusis@gmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/kamusis" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://twitter.com/kamusis" class="iconfont-archer twitter" target="_blank" title=twitter></a>
            
        
    
        
            
                <a href="https://www.instagram.com/kamusis/" class="iconfont-archer instagram" target="_blank" title=instagram></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://www.linkedin.com/in/kamus/" class="iconfont-archer linkedin" target="_blank" title=linkedin></a>
            
        
    
        
    
        
    
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Diagnostic-Needs"><span class="toc-number">1.</span> <span class="toc-text">Diagnostic Needs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-Get-Thread-ID"><span class="toc-number">2.</span> <span class="toc-text">How to Get Thread ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-Map-OS-Thread-ID-to-Database-Session"><span class="toc-number">3.</span> <span class="toc-text">How to Map OS Thread ID to Database Session</span></a></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 6
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/How-to-build-blog-site-by-using-Hexo-in-Windows-WSL-and-deploy-to-GitHub-Pages/">How to build blog site by using Hexo in Windows WSL and deploy to GitHub Pages</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/How-to-Find-the-Corresponding-Session-in-MogDB-openGauss-from-OS-Thread-ID/">How to Find the Corresponding Session in MogDB/openGauss from OS Thread ID</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/MogDB-ASH-Unveiling-the-Active-Session-History-for-Powerful-Database-Performance-Tuning/">MogDB ASH: Unveiling the Active Session History for Powerful Database Performance Tuning</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/How-to-move-WSL-distro-in-Windows-11-to-another-drive/">How to move WSL distro in Windows 11 to another drive</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/Unlocking-the-Power-Key-Features-of-MogDB/">Unlocking the Power: Key Features of MogDB</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2024/05/27/Advanced-topic-using-MTK-to-migrate-Oracle-sample-schema-to-MogDB/">Advanced topic - using MTK to migrate Oracle sample schema to MogDB</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="MogDB, Oracle, Migration">
                <span class="iconfont-archer">&#xe606;</span>
                MogDB, Oracle, Migration
            </span>
        
            <span class="sidebar-tag-name" data-tags="Hexo, Github Pages, WSL">
                <span class="iconfont-archer">&#xe606;</span>
                Hexo, Github Pages, WSL
            </span>
        
            <span class="sidebar-tag-name" data-tags="MogDB">
                <span class="iconfont-archer">&#xe606;</span>
                MogDB
            </span>
        
            <span class="sidebar-tag-name" data-tags="Windows, WSL">
                <span class="iconfont-archer">&#xe606;</span>
                Windows, WSL
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "http://kamusis.github.io",
        root: siteMetaRoot,
        author: "Kamus"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20240527"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20240527"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20240527" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
