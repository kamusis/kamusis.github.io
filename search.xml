<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Advanced topic - using MTK to migrate Oracle sample schema to MogDB</title>
    <url>/2024/05/27/Advanced-topic-using-MTK-to-migrate-Oracle-sample-schema-to-MogDB/</url>
    <content><![CDATA[<h1 id="Advanced-topic-using-MTK-to-migrate-Oracle-sample-schema-to-MogDB"><a href="#Advanced-topic-using-MTK-to-migrate-Oracle-sample-schema-to-MogDB" class="headerlink" title="Advanced topic - using MTK to migrate Oracle sample schema to MogDB"></a>Advanced topic - using MTK to migrate Oracle sample schema to MogDB</h1><h2 id="Get-the-latest-version-MTK"><a href="#Get-the-latest-version-MTK" class="headerlink" title="Get the latest version MTK."></a>Get the latest version MTK.</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget https://cdn-mogdb.enmotech.com/mtk/v2.6.3/mtk_2.6.3_linux_amd64.tar.gz</span><br><span class="line">tar -xvf mtk_2.6.3_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>



<h2 id="Gernerate-MTK-trial-license-online"><a href="#Gernerate-MTK-trial-license-online" class="headerlink" title="Gernerate MTK trial license online"></a>Gernerate MTK trial license online</h2><p>The trial license lasts for 1 month, every mail address can only gernerate one license, except the mail address domain is “enmotech.com”, using “enmotech.com” mail can repeatly genarate license. So if the clients want to try MTK more  after 1 month, should contact the sales or pre-sales from Enmotech, to ask for another 1 month license.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[kamus@altlinux10 mtk_2.6.3_linux_amd64]$ ./mtk license gen</span><br><span class="line">License File Not Found (default license.json)</span><br><span class="line">The License code is invalid, start applying</span><br><span class="line">✔ Email: kamus@enmotech.com█</span><br><span class="line">Start applying for email kamus@enmotech.com authorization.</span><br><span class="line">Start parsing the interface to return data.</span><br><span class="line">Successful application for authorization. Please check the mail and save it as license.json.</span><br></pre></td></tr></table></figure>



<p>When get the mail, upload the attached license.json file to the MTK directory.  Use <code>mtk -v</code>  to check the license validation.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[kamus@altlinux10 mtk_2.6.3_linux_amd64]$ ./mtk -v</span><br><span class="line">Using license file: /home/kamus/mogdb-tools/mtk_2.6.3_linux_amd64/license.json</span><br><span class="line">Name: kamus@enmotech.com</span><br><span class="line">Expiry: 2022-10-24 12:08:58.751194162 +0800 +0800</span><br><span class="line">License key verified!</span><br><span class="line">License checks OK!</span><br><span class="line"></span><br><span class="line">MMMMMMMM               MMMMMMMMTTTTTTTTTTTTTTTTTTTTTTTKKKKKKKKK    KKKKKKK</span><br><span class="line">M:::::::M             M:::::::MT:::::::::::::::::::::TK:::::::K    K:::::K</span><br><span class="line">M::::::::M           M::::::::MT:::::::::::::::::::::TK:::::::K    K:::::K</span><br><span class="line">M:::::::::M         M:::::::::MT:::::TT:::::::TT:::::TK:::::::K   K::::::K</span><br><span class="line">M::::::::::M       M::::::::::MTTTTTT  T:::::T  TTTTTTKK::::::K  K:::::KKK</span><br><span class="line">M:::::::::::M     M:::::::::::M        T:::::T          K:::::K K:::::K</span><br><span class="line">M:::::::M::::M   M::::M:::::::M        T:::::T          K::::::K:::::K</span><br><span class="line">M::::::M M::::M M::::M M::::::M        T:::::T          K:::::::::::K</span><br><span class="line">M::::::M  M::::M::::M  M::::::M        T:::::T          K:::::::::::K</span><br><span class="line">M::::::M   M:::::::M   M::::::M        T:::::T          K::::::K:::::K</span><br><span class="line">M::::::M    M:::::M    M::::::M        T:::::T          K:::::K K:::::K</span><br><span class="line">M::::::M     MMMMM     M::::::M        T:::::T        KK::::::K  K:::::KKK</span><br><span class="line">M::::::M               M::::::M      TT:::::::TT      K:::::::K   K::::::K</span><br><span class="line">M::::::M               M::::::M      T:::::::::T      K:::::::K    K:::::K</span><br><span class="line">M::::::M               M::::::M      T:::::::::T      K:::::::K    K:::::K</span><br><span class="line">MMMMMMMM               MMMMMMMM      TTTTTTTTTTT      KKKKKKKKK    KKKKKKK</span><br><span class="line"></span><br><span class="line">Release version: v2.6.3</span><br><span class="line">Git Commit hash: da0ed8ee</span><br><span class="line">Git Commit Date: 2022-09-22T01:17:49Z</span><br><span class="line">Git Tag        : v2.6.3</span><br><span class="line">Build timestamp: 20220922011907</span><br></pre></td></tr></table></figure>



<h2 id="Install-Oracle-instant-client"><a href="#Install-Oracle-instant-client" class="headerlink" title="Install Oracle instant client"></a>Install Oracle instant client</h2><p>MTK needs <a href="https://www.oracle.com/database/technologies/instant-client/downloads.html">Oracle instant client</a>  to migrate Oracle objects to MogDB, in this tutorial, we will download <a href="https://download.oracle.com/otn_software/linux/instantclient/217000/instantclient-basic-linux.x64-21.7.0.0.0dbru.zip">Oracle Instant Client for Linux x86-64 Basic Package</a>. Unzip the downloaded file, set the proper <code>LD_LIBRARY_PATH</code> parameter.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/home/kamus/instantclient_21_7:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>



<p>We will migrate a sample schema “customer_orders” to MogDB in this tutorial. the <a href="https://github.com/oracle-samples/db-sample-schemas">db-sample-schemas</a> scipts for Oracle can be downloaded from github.</p>
<p><img src="https://s2.loli.net/2022/09/24/mKnfuY28shRNI9X.png" alt="image-20220924140451621"></p>
<h2 id="Initialize-migration-project"><a href="#Initialize-migration-project" class="headerlink" title="Initialize migration project"></a>Initialize migration project</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./mtk init-project -s oracle -t mogdb -n ora2mogdb</span><br></pre></td></tr></table></figure>



<h2 id="Modify-MTK-configuration-file"><a href="#Modify-MTK-configuration-file" class="headerlink" title="Modify MTK configuration file"></a>Modify MTK configuration file</h2><p>Modify the example MTK confiuration file stored in project_name_dir&#x2F;config directory, check <a href="https://docs.mogdb.io/en/mtk/v2.0/mtk-parameter">MTK documentation</a> for the details of every parameter. The essenssial config sections  for MTK is <code>source</code>, <code>target</code>, <code>object</code> .</p>
<p><code>source</code> section: is the connection defination for source database, MTK needs to query Oracle database dictionary to get DDL, so typically we should use DBA user, the default system user will be OK.</p>
<p><code>target</code> section: is the connection defination for target database.</p>
<p><code>object</code> section: for migrating all the objects in one schema, we just need to put schema name in <code>schemas</code> section. </p>
<p>The mtk.json config file will looks like:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;source&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;oracle&quot;,</span><br><span class="line">      &quot;connect&quot;: &#123;</span><br><span class="line">        &quot;version&quot;: &quot;&quot;,</span><br><span class="line">        &quot;host&quot;: &quot;119.3.182.31&quot;,</span><br><span class="line">        &quot;user&quot;: &quot;system&quot;,</span><br><span class="line">        &quot;port&quot;: 15221,</span><br><span class="line">        &quot;password&quot;: &quot;oracle&quot;,</span><br><span class="line">        &quot;dbName&quot;: &quot;ORACLE21C&quot;,</span><br><span class="line">        &quot;charset&quot;: &quot;&quot;,</span><br><span class="line">        &quot;clientCharset&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;target&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;mogdb&quot;,</span><br><span class="line">      &quot;connect&quot;: &#123;</span><br><span class="line">        &quot;version&quot;: &quot;&quot;,</span><br><span class="line">        &quot;host&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">        &quot;user&quot;: &quot;co&quot;,</span><br><span class="line">        &quot;port&quot;: 26000,</span><br><span class="line">        &quot;password&quot;: &quot;Enmo@123&quot;,</span><br><span class="line">        &quot;dbName&quot;: &quot;postgres&quot;,</span><br><span class="line">        &quot;charset&quot;: &quot;&quot;,</span><br><span class="line">        &quot;clientCharset&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;object&quot;: &#123;</span><br><span class="line">      &quot;tables&quot;: [],</span><br><span class="line">      &quot;schemas&quot;: [&quot;co&quot;],</span><br><span class="line">      &quot;excludeTable&quot;: &#123;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;tableSplit&quot;: &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;dataOnly&quot;: false,</span><br><span class="line">    &quot;schemaOnly&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>We are planning to migrate all the objects in “CO” schema from Oracle database to the same user in MogDB, for testing purpose, we will not create a new database in MogDB, we create a new user “co” in default database postgres.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[omm@altlinux10 ~]$ gsql -d postgres -p 26000 -r</span><br><span class="line">gsql ((MogDB 3.0.2 build 9bc79be5) compiled at 2022-09-18 00:37:49 commit 0 last mr  )</span><br><span class="line">Non-SSL connection (SSL connection is recommended when requiring high-security)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">MogDB=# create user co identified by &quot;Enmo@123&quot;;</span><br><span class="line">CREATE ROLE</span><br></pre></td></tr></table></figure>



<h2 id="Start-migration"><a href="#Start-migration" class="headerlink" title="Start migration"></a>Start migration</h2><p>Now, we can start migration.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./mtk -c ora2mogdb/config/mtk.json</span><br></pre></td></tr></table></figure>



<h2 id="Check-migration-report"><a href="#Check-migration-report" class="headerlink" title="Check migration report"></a>Check migration report</h2><p>Migration result report will be generated in project report directory, both in pure text format and HTML format, till now the HTML report is in Chinese, so I put the text format result into this tutorial.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----------------------</span><br><span class="line">ObjectName Type Summary</span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">+------------------+-------------------+-------------------+--------+-----------+-------------+-------------+-------------+--------------------|-------------+</span><br><span class="line">|       Type       |     StartTime     |      EndTime      | Status | Total Num | Success Num | Warring Num | Failed  Num |Failed(Invalid) Num | Time        |</span><br><span class="line">+------------------+-------------------+-------------------+--------+-----------+-------------+-------------+-------------+--------------------|-------------+</span><br><span class="line">|Schema            |2022-09-24 15:12:36|2022-09-24 15:12:36|finish  |1          |1            |0            |0            |0                   |282 ms       ｜</span><br><span class="line">|Sequence          |2022-09-24 15:12:36|2022-09-24 15:12:36|finish  |0          |0            |0            |0            |0                   |210 ms       ｜</span><br><span class="line">|ObjectType        |2022-09-24 15:12:36|2022-09-24 15:12:36|finish  |0          |0            |0            |0            |0                   |356 ms       ｜</span><br><span class="line">|Queue             |2022-09-24 15:12:36|2022-09-24 15:12:37|finish  |0          |0            |0            |0            |0                   |177 ms       ｜</span><br><span class="line">|Table             |2022-09-24 15:12:37|2022-09-24 15:12:47|finish  |7          |7            |0            |0            |0                   |9 s 952 ms   ｜</span><br><span class="line">|TableData         |2022-09-24 15:12:47|2022-09-24 15:12:53|finish  |7          |7            |0            |0            |0                   |6 s 743 ms   ｜</span><br><span class="line">|Index             |2022-09-24 15:12:53|2022-09-24 15:12:53|finish  |7          |7            |0            |0            |0                   |1 ms         ｜</span><br><span class="line">|Constraint        |2022-09-24 15:12:53|2022-09-24 15:12:53|finish  |24         |23           |0            |1            |0                   |51 ms        ｜</span><br><span class="line">|DBLink            |2022-09-24 15:12:53|2022-09-24 15:12:53|finish  |0          |0            |0            |0            |0                   |67 ms        ｜</span><br><span class="line">|View              |2022-09-24 15:12:53|2022-09-24 15:12:54|finish  |4          |2            |0            |2            |0                   |723 ms       ｜</span><br><span class="line">|MaterializedView  |2022-09-24 15:12:54|2022-09-24 15:12:54|finish  |0          |0            |0            |0            |0                   |138 ms       ｜</span><br><span class="line">|Function          |2022-09-24 15:12:54|2022-09-24 15:12:54|finish  |0          |0            |0            |0            |0                   |113 ms       ｜</span><br><span class="line">|Procedure         |2022-09-24 15:12:54|2022-09-24 15:12:55|finish  |0          |0            |0            |0            |0                   |109 ms       ｜</span><br><span class="line">|Package           |2022-09-24 15:12:55|2022-09-24 15:12:55|finish  |0          |0            |0            |0            |0                   |77 ms        ｜</span><br><span class="line">|Trigger           |2022-09-24 15:12:55|2022-09-24 15:12:55|finish  |0          |0            |0            |0            |0                   |404 ms       ｜</span><br><span class="line">|Synonym           |2022-09-24 15:12:55|2022-09-24 15:12:55|finish  |0          |0            |0            |0            |0                   |74 ms        ｜</span><br><span class="line">|TableDataCom      |2022-09-24 15:12:55|2022-09-24 15:12:56|finish  |7          |7            |0            |0            |0                   |810 ms       ｜</span><br><span class="line">|AlterSequence     |2022-09-24 15:12:56|2022-09-24 15:12:56|finish  |0          |0            |0            |0            |0                   |71 ms        ｜</span><br><span class="line">|CollStatistics    |2022-09-24 15:12:56|2022-09-24 15:12:56|finish  |7          |7            |0            |0            |0                   |29 ms        ｜</span><br><span class="line">+------------------+-------------------+-------------------+--------+-----------+-------------+-------------+-------------+--------------------|-------------+</span><br></pre></td></tr></table></figure>



<p>We can see all the tables and table data are successfully migrated to MogDB without any error, but for constraint, there is 1 failed, and for view, there are 2 failed.</p>
<p>The failed constraint is a JSON check constraint. MogDB dosn’t has this type of constraint.</p>
<p><img src="https://s2.loli.net/2022/09/24/RDKmsNFvroWTPgZ.png" alt="image-20220924153609138"></p>
<p>The failed views are about grouping_id function and json_table function which MogDB not implemented yet.</p>
<table>
<thead>
<tr>
<th>SQL</th>
<th>ERROR</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://s2.loli.net/2022/09/24/4BMfnQ6alrqhvd8.png" alt="image-20220924154621375"></td>
<td>pq: function grouping_id(character varying, character varying) does not exist</td>
</tr>
<tr>
<td><img src="https://s2.loli.net/2022/09/24/D6kHROy3vFULnQA.png" alt="image-20220924154529308"></td>
<td>pq: syntax error at or near “columns”</td>
</tr>
</tbody></table>
<h2 id="Run-the-sample-queries"><a href="#Run-the-sample-queries" class="headerlink" title="Run the sample queries"></a>Run the sample queries</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/* 5 products with the highest revenue</span><br><span class="line">   With their corresponding order rank */</span><br><span class="line">select p.product_name, </span><br><span class="line">       count(*) number_of_orders,</span><br><span class="line">       sum ( oi.quantity * oi.unit_price ) total_value,</span><br><span class="line">       rank () over ( </span><br><span class="line">         order by count(*) desc </span><br><span class="line">       ) order_count_rank</span><br><span class="line">from   products p</span><br><span class="line">join   order_items oi</span><br><span class="line">on     p.product_id = oi.product_id</span><br><span class="line">group  by p.product_name</span><br><span class="line">order  by sum ( oi.quantity * oi.unit_price ) desc</span><br><span class="line">fetch  first 5 rows only;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MogDB=&gt; select p.product_name,</span><br><span class="line">MogDB-&gt;        count(*) number_of_orders,</span><br><span class="line">MogDB-&gt;        sum ( oi.quantity * oi.unit_price ) total_value,</span><br><span class="line">MogDB-&gt;        rank () over (</span><br><span class="line">MogDB(&gt;          order by sum ( oi.quantity * oi.unit_price ) desc</span><br><span class="line">MogDB(&gt;        ) revenue_rank</span><br><span class="line">MogDB-&gt; from   products p</span><br><span class="line">MogDB-&gt; join   order_items oi</span><br><span class="line">MogDB-&gt; on     p.product_id = oi.product_id</span><br><span class="line">MogDB-&gt; group  by p.product_name</span><br><span class="line">MogDB-&gt; order  by count(*) desc</span><br><span class="line">MogDB-&gt; fetch  first 5 rows only;</span><br><span class="line">     product_name      | number_of_orders | total_value | revenue_rank</span><br><span class="line">-----------------------+------------------+-------------+--------------</span><br><span class="line"> Girl&#x27;s Trousers (Red) |              148 |    15794.76 |            1</span><br><span class="line"> Boy&#x27;s Hoodie (Grey)   |              100 |     3754.08 |           35</span><br><span class="line"> Men&#x27;s Pyjamas (Blue)  |              100 |     3274.61 |           36</span><br><span class="line"> Men&#x27;s Coat (Red)      |               98 |     4230.30 |           31</span><br><span class="line"> Boy&#x27;s Socks (White)   |               98 |     3081.12 |           38</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>



<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Migrating tables&#x2F;table data&#x2F;indexes from Oracle to MogDB normally has no issue, but for views&#x2F;procedures&#x2F;functions&#x2F;packages, we still have to made some modification to the source code.<img src="https://s2.loli.net/2022/09/24/RDKmsNFvroWTPgZ.png"></p>
]]></content>
      <tags>
        <tag>MogDB, Oracle, Migration</tag>
      </tags>
  </entry>
  <entry>
    <title>first-post</title>
    <url>/2024/05/27/first-post/</url>
    <content><![CDATA[<h1 id="Only-a-test"><a href="#Only-a-test" class="headerlink" title="Only a test"></a>Only a test</h1><h2 id="Here-is-a-test-region"><a href="#Here-is-a-test-region" class="headerlink" title="Here is a test region"></a>Here is a test region</h2><p>Close it</p>
<h2 id="Here-is-another-test-region"><a href="#Here-is-another-test-region" class="headerlink" title="Here is another test region"></a>Here is another test region</h2><p>Open it</p>
]]></content>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
</search>
